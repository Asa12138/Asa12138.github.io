<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Construction | MetaNet Tutorial</title>
<meta name="author" content="Peng Chen">
<meta name="description" content="2.1 Pre-processing The trans() function contains many normalization methods, suitable for pre-processing of different omics, some refer to vegan::decostand() (1). Table 2.1: Normalization methods...">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="Chapter 2 Construction | MetaNet Tutorial">
<meta property="og:type" content="book">
<meta property="og:description" content="2.1 Pre-processing The trans() function contains many normalization methods, suitable for pre-processing of different omics, some refer to vegan::decostand() (1). Table 2.1: Normalization methods...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Construction | MetaNet Tutorial">
<meta name="twitter:description" content="2.1 Pre-processing The trans() function contains many normalization methods, suitable for pre-processing of different omics, some refer to vegan::decostand() (1). Table 2.1: Normalization methods...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script><script src="libs/sankeyNetwork-binding-0.3.2/sankeyNetwork.js"></script><script src="libs/d3-4.13.0/d3.min.js"></script><script src="libs/sankey-0.1/sankey.js"></script><script src="libs/forceNetwork-binding-0.4/forceNetwork.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">MetaNet Tutorial</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="active" href="construction.html"><span class="header-section-number">2</span> Construction</a></li>
<li><a class="" href="manipulation.html"><span class="header-section-number">3</span> Manipulation</a></li>
<li><a class="" href="visualization.html"><span class="header-section-number">4</span> Visualization</a></li>
<li><a class="" href="topology.html"><span class="header-section-number">5</span> Topology</a></li>
<li><a class="" href="stability.html"><span class="header-section-number">6</span> Stability</a></li>
<li><a class="" href="Multi-omics.html"><span class="header-section-number">7</span> Multi-omics</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/Asa12138/MetaNet_tutorial">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="construction" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Construction<a class="anchor" aria-label="anchor" href="#construction"><i class="fas fa-link"></i></a>
</h1>
<div id="normalization" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Pre-processing<a class="anchor" aria-label="anchor" href="#normalization"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/pkg/pcutils/man/trans.html">trans()</a></code> function contains many normalization methods, suitable for pre-processing of different omics, some refer to <code><a href="https://rdrr.io/pkg/vegan/man/decostand.html">vegan::decostand()</a></code> <span class="citation">(<a href="references.html#ref-R-vegan"><em>1</em></a>)</span>.</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:3-normalize">Table 2.1: </span> Normalization methods used in omics.</caption>
<colgroup>
<col width="8%">
<col width="91%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Method</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="even">
<td>cpm</td>
<td>Counts per million</td>
</tr>
<tr class="odd">
<td>minmax</td>
<td>linear transfer to (min, max)</td>
</tr>
<tr class="even">
<td>acpm</td>
<td>Counts per million, then asinh transfer</td>
</tr>
<tr class="odd">
<td>log1</td>
<td>log(n+1) transformat</td>
</tr>
<tr class="even">
<td>total</td>
<td>divide by total</td>
</tr>
<tr class="odd">
<td>max</td>
<td>divide by maximum</td>
</tr>
<tr class="even">
<td>frequency</td>
<td>divide by total and multiply by the number of non-zero items, so that the average of non-zero entries is one</td>
</tr>
<tr class="odd">
<td>normalize</td>
<td>make margin sum of squares equal to one</td>
</tr>
<tr class="even">
<td>range</td>
<td>standardize values into range 0 ... 1 (same to <code>minmax(0,1)</code>). If all values are constant, they will be transformed to 0.</td>
</tr>
<tr class="odd">
<td>rank</td>
<td>rank replaces abundance values by their increasing ranks leaving zeros unchanged</td>
</tr>
<tr class="even">
<td>rank, rrank</td>
<td>rank replaces abundance values by their increasing ranks leaving zeros unchanged, and rrank is similar but uses relative ranks with maximum 1</td>
</tr>
<tr class="odd">
<td>pa</td>
<td>scale x to presence/absence scale (0/1).</td>
</tr>
<tr class="even">
<td>standardize</td>
<td>scale x to zero mean and unit variance</td>
</tr>
<tr class="odd">
<td>hellinger</td>
<td>square root of method = “total”</td>
</tr>
<tr class="even">
<td>log</td>
<td>logarithmic transformation as suggested by Anderson et al. (2006): logb(x)+1 for x&gt;0, where bb is the base of the logarithm; zeros are left as zeros.</td>
</tr>
<tr class="odd">
<td>alr</td>
<td>
<p>Additive log ratio (“alr”) transformation (Aitchison 1986) reduces data skewness and compositionality bias.</p>
<p><span class="math inline">\(alr=[log\frac{x_1}{x_D},…,log\frac{x_{D-1}}{x_D}]\)</span></p>
</td>
</tr>
<tr class="even">
<td>clr</td>
<td>
<p>centered log ratio (“clr”) transformation proposed by Aitchison (1986) reduces data skewness and compositionality bias.</p>
<p><span class="math inline">\(clr=log\frac{x_r}{g(x_r)}\)</span></p>
</td>
</tr>
<tr class="odd">
<td>rclr</td>
<td>
<p>robust clr (“rclr”) is similar to regular clr (see above) but allows data that contains zeroes.</p>
<p><span class="math inline">\(rclr=log\frac{x_r}{g(x_r&gt;0)}\)</span></p>
</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Asa12138/MetaNet">MetaNet</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">otutab</span>,package <span class="op">=</span> <span class="st">"pcutils"</span><span class="op">)</span></span>
<span><span class="co">#trans(otutab,method="cpm")%&gt;%head()</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pcutils/man/trans.html">trans</a></span><span class="op">(</span><span class="va">otutab</span>,method<span class="op">=</span><span class="st">"log1"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                   NS1      NS2      NS3</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 6.996681 7.560601 6.698268</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        7.582229 7.118826 7.767687</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     6.378426 6.129050 6.791221</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     5.501258 5.459586 7.501634</span></span>
<span><span class="co">#&gt;                                   NS4      NS5      NS6</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 7.211557 6.970730 6.976348</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        7.712891 7.973844 7.512071</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     6.804615 7.112327 6.749931</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     6.513230 7.276556 6.198479</span></span>
<span><span class="co">#&gt;                                   WS1      WS2      WS3</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 7.133296 7.376508 7.193686</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        6.469250 6.206576 7.115582</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     6.405228 6.154858 6.976348</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     5.765191 7.563720 7.309212</span></span>
<span><span class="co">#&gt;                                   WS4      WS5      WS6</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 6.848005 7.118016 6.919684</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        7.158514 6.860664 6.455199</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     6.936343 6.741701 6.508769</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     6.903747 6.359574 5.886104</span></span>
<span><span class="co">#&gt;                                   CS1      CS2      CS3</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 7.746733 7.831617 7.444249</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        7.174724 7.324490 6.739337</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     6.937314 7.497207 6.910751</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     6.985642 7.105786 6.626718</span></span>
<span><span class="co">#&gt;                                   CS4      CS5      CS6</span></span>
<span><span class="co">#&gt; s__un_f__Thermomonosporaceae 7.588830 7.266827 7.331715</span></span>
<span><span class="co">#&gt; s__Pelomonas_puraquae        7.029088 7.302496 7.069023</span></span>
<span><span class="co">#&gt; s__Rhizobacter_bergeniae     7.090910 7.085901 6.637258</span></span>
<span><span class="co">#&gt; s__Flavobacterium_terrae     6.049733 6.940222 7.253470</span></span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/pcutils/man/guolv.html">guolv()</a></code> and <code><a href="https://rdrr.io/pkg/pcutils/man/hebing.html">hebing()</a></code> functions can help filter or aggregate the omics data.</p>
</div>
<div id="pairwise-relationship" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Pairwise relationship<a class="anchor" aria-label="anchor" href="#pairwise-relationship"><i class="fas fa-link"></i></a>
</h2>
<p>How to determine the pairwise relationship, because the experimental data is generally relatively rare, we mainly relying on statistical inference.</p>
<p>At present, there are mainly two ways, the first one is based on similarity or correlation <span class="citation">(<a href="references.html#ref-faustMicrobialInteractionsNetworks2012"><em>2</em></a>)</span>. for example: Spearman, Pearson, Bray-Curtis… based on abundance or incidence data, the similarity matrix between paired species can be calculated, and the randomized data can be used to repeatedly calculate the significance.Finally, meaningful similarities are retained in network.</p>
<p>The second way for networks is based on regression. Divide species into source and target, and use multiple regression to calculate the relationship between species.</p>
<p>Some tools use special methods to optimize the network construction, such as <strong>SparCC</strong>, etc.</p>
<div id="correlation" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Correlation<a class="anchor" aria-label="anchor" href="#correlation"><i class="fas fa-link"></i></a>
</h3>
<p><strong>Correlation</strong> is a statistical term describing the degree to which two variables move in coordination with one-another.</p>
<p>Correlation calculation is the first step in all omics network analysis software, there are many method to get <span class="math inline">\(\rho\)</span> and <span class="math inline">\(p\)</span>-value. However, as the data size of omics grow larger and larger, many methods will become very time and computational resource consuming.</p>
<p>Here, we provide the <code><a href="https://rdrr.io/pkg/MetaNet/man/c_net_cal.html">c_net_cal()</a></code> function for one single table or two tables to calculate correlation <strong>fastly</strong> (Figure <a href="construction.html#fig:3-packages-comparison">2.1</a>), which will return a three elements list include <span class="math inline">\(\rho\)</span>, <span class="math inline">\(p\)</span>-value and <span class="math inline">\(p\)</span>-adjust.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#single table</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">otutab</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">totu</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/c_net_cal.html">c_net_cal</a></span><span class="op">(</span><span class="va">totu</span>,method <span class="op">=</span> <span class="st">"spearman"</span>, filename <span class="op">=</span><span class="cn">F</span>,p.adjust.method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">corr</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">corr</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ r       : num [1:492, 1:492] 1 -0.2508 0.1847 0.0114 0.2095 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;  $ p.value : num [1:492, 1:492] 0 0.316 0.463 0.964 0.404 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;  $ p.adjust: num [1:492, 1:492] 0 0.316 0.463 0.964 0.404 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "corr"</span></span>
<span></span>
<span><span class="co">#two tables</span></span>
<span><span class="va">metadata</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op">-&gt;</span> <span class="va">env</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/c_net_cal.html">c_net_cal</a></span><span class="op">(</span><span class="va">totu</span>,<span class="va">env</span>,method <span class="op">=</span> <span class="st">"spearman"</span>, filename <span class="op">=</span><span class="cn">F</span>,p.adjust.method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">corr2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">corr2</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ r       : num [1:492, 1:8] 0.356 -0.5253 0.0918 -0.0114 -0.0196 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:8] "env1" "env2" "env3" "env4" ...</span></span>
<span><span class="co">#&gt;  $ p.value : num [1:492, 1:8] 0.147 0.0252 0.717 0.9643 0.9384 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:8] "env1" "env2" "env3" "env4" ...</span></span>
<span><span class="co">#&gt;  $ p.adjust: num [1:492, 1:8] 0.147 0.0252 0.717 0.9643 0.9384 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:492] "s__un_f__Thermomonosporaceae" "s__Pelomonas_puraquae" "s__Rhizobacter_bergeniae" "s__Flavobacterium_terrae" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:8] "env1" "env2" "env3" "env4" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "corr"</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-packages-comparison"></span>
<img src="02-construction_files/figure-html/3-packages-comparison-1.png" alt="network build of packages comparison" width="100%"><p class="caption">
Figure 2.1: network build of packages comparison
</p>
</div>
</div>
<div id="distance" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Distance<a class="anchor" aria-label="anchor" href="#distance"><i class="fas fa-link"></i></a>
</h3>
<p>you can use <code><a href="https://rdrr.io/pkg/MetaNet/man/par_sim.html">par_sim()</a></code> to calculate various distance to get the pairwise similarity matrix.</p>
</div>
<div id="sparcc" class="section level3" number="2.2.3">
<h3>
<span class="header-section-number">2.2.3</span> SparCC<a class="anchor" aria-label="anchor" href="#sparcc"><i class="fas fa-link"></i></a>
</h3>
<p>SparCC fits the Dirichlet distribution to the observed data, and iteratively calculates the proportion and correlation of species several times. The resulting correlation is the median of the distribution. <span class="math inline">\(p\)</span>-values were calculated using the bootstrap method.This metric is said to be more useful with non-normal microbiome data.</p>
<p><span class="math inline">\(D(x_i,x_j)=var(\log(\frac{x_i}{x_j}))\)</span></p>
<p><code><a href="https://rdrr.io/pkg/MetaNet/man/par_sparcc.html">par_sparcc()</a></code> is available for SparCC calculation.</p>
</div>
<div id="others" class="section level3" number="2.2.4">
<h3>
<span class="header-section-number">2.2.4</span> Others<a class="anchor" aria-label="anchor" href="#others"><i class="fas fa-link"></i></a>
</h3>
<p>There are some other methods available for network construction in <a href="https://github.com/stefpeschel/NetCoMi"><strong>NetCoMi</strong></a></p>
</div>
</div>
<div id="build-network" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Build network<a class="anchor" aria-label="anchor" href="#build-network"><i class="fas fa-link"></i></a>
</h2>
<div id="normally-build" class="section level3" number="2.3.1">
<h3>
<span class="header-section-number">2.3.1</span> Normally build<a class="anchor" aria-label="anchor" href="#normally-build"><i class="fas fa-link"></i></a>
</h3>
<p>If you have done the <code><a href="https://rdrr.io/pkg/MetaNet/man/c_net_cal.html">c_net_cal()</a></code>, you can get a network (igraph object) easily by <code><a href="https://rdrr.io/pkg/MetaNet/man/c_net_build.html">c_net_build()</a></code>. Some common attributes will be set automatically.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/c_net_build.html">c_net_build</a></span><span class="op">(</span><span class="va">corr</span>,r_thres <span class="op">=</span> <span class="fl">0.6</span>,p_thres <span class="op">=</span> <span class="fl">0.05</span>,del_single <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">co_net</span></span>
<span><span class="va">co_net</span></span>
<span><span class="co">#&gt; ====================================metanet===================================== </span></span>
<span><span class="co">#&gt; IGRAPH 8746e6f UNW- 490 1545 -- </span></span>
<span><span class="co">#&gt; + attr: n_type (g/c), name (v/c), v_group (v/c),</span></span>
<span><span class="co">#&gt; | v_class (v/c), size (v/n), label (v/c), shape</span></span>
<span><span class="co">#&gt; | (v/c), color (v/c), id (e/n), from (e/c), to (e/c),</span></span>
<span><span class="co">#&gt; | weight (e/n), cor (e/n), e_type (e/c), width (e/n),</span></span>
<span><span class="co">#&gt; | v_group_from (e/c), v_group_to (e/c), e_class</span></span>
<span><span class="co">#&gt; | (e/c), color (e/c), lty (e/n)</span></span>
<span><span class="co">#&gt; + edges from 8746e6f (vertex names):</span></span>
<span><span class="co">#&gt; [1] s__un_f__Thermomonosporaceae--s__Actinocorallia_herbida</span></span>
<span><span class="co">#&gt; [2] s__un_f__Thermomonosporaceae--s__Kribbella_catacumbae  </span></span>
<span><span class="co">#&gt; [3] s__un_f__Thermomonosporaceae--s__Kineosporia_rhamnosa  </span></span>
<span><span class="co">#&gt; + ... omitted several edges</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">co_net</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-conet1"></span>
<img src="02-construction_files/figure-html/3-conet1-1.png" alt="Simple co-occurrence network" width="100%"><p class="caption">
Figure 2.2: Simple co-occurrence network
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/c_net_build.html">c_net_build</a></span><span class="op">(</span><span class="va">corr2</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">co_net2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">co_net2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-conet2"></span>
<img src="02-construction_files/figure-html/3-conet2-1.png" alt="Simple bipartite network" width="100%"><p class="caption">
Figure 2.3: Simple bipartite network
</p>
</div>
</div>
<div id="multi-tables" class="section level3" number="2.3.2">
<h3>
<span class="header-section-number">2.3.2</span> Multi-tables<a class="anchor" aria-label="anchor" href="#multi-tables"><i class="fas fa-link"></i></a>
</h3>
<p>When you have more than two tables for correlation network analysis, you can choose the <code><a href="https://rdrr.io/pkg/MetaNet/man/multi_net_build.html">multi_net_build()</a></code> to calculate and build network. For subsequent <strong>multi-omics analysis</strong>, see Chapter <a href="#multi-omics"><strong>??</strong></a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"multi_test"</span><span class="op">)</span></span>
<span><span class="co">#microbiome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">micro</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18 50</span></span>
<span><span class="co">#metabolome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">metab</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18 50</span></span>
<span><span class="co">#transcriptome</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">transc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 18 50</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/multi_net_build.html">multi_net_build</a></span><span class="op">(</span><span class="va">micro</span>,<span class="va">metab</span>,<span class="va">transc</span>,mode <span class="op">=</span> <span class="st">"full"</span>,method <span class="op">=</span> <span class="st">"spearman"</span>,filename <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">-&gt;</span><span class="va">multi1</span></span>
<span><span class="co">#&gt; Calculating 18 samples and 150 objects of 3 groups.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">multi1</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-multinet1"></span>
<img src="02-construction_files/figure-html/3-multinet1-1.png" alt="Simple multi-omics network" width="100%"><p class="caption">
Figure 2.4: Simple multi-omics network
</p>
</div>
</div>
<div id="edgelist" class="section level3" number="2.3.3">
<h3>
<span class="header-section-number">2.3.3</span> Edgelist<a class="anchor" aria-label="anchor" href="#edgelist"><i class="fas fa-link"></i></a>
</h3>
<p>If you already get the pairwise relationship of data from other approaches (database), you can form it into a edgelist and use <code>c_net_from_edgelist</code> to build network. It is useful for following analysis.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"edgelist"</span>,package <span class="op">=</span> <span class="st">"MetaNet"</span><span class="op">)</span></span>
<span><span class="va">dnet</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/c_net_from_edgelist.html">c_net_from_edgelist</a></span><span class="op">(</span><span class="va">arc_count</span>,direct <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dnet</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-directnet"></span>
<img src="02-construction_files/figure-html/3-directnet-1.png" alt="Simple directed network" width="100%"><p class="caption">
Figure 2.5: Simple directed network
</p>
</div>
</div>
</div>
<div id="rmt-optimize" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> RMT optimize<a class="anchor" aria-label="anchor" href="#rmt-optimize"><i class="fas fa-link"></i></a>
</h2>
<p>The correlation-based relevance network method is most commonly used largely due to its simple calculation procedure and noise tolerance. However, most studies involving relevance network analysis use arbitrary thresholds (usually, we use r&gt;0.6, p&lt;0.05), and thus the constructed networks are subjective rather than objective.</p>
<p>This problem has been solved by a random matrix theory (RMT)-based approach (Figure <a href="construction.html#fig:3-RMT">2.6</a>), which is able to automatically identify a threshold for cellular network construction from micro-array data <span class="citation">(<a href="references.html#ref-dengMolecularEcologicalNetwork2012"><em>3</em></a>)</span>.</p>
<div class="figure">
<span style="display:block;" id="fig:3-RMT"></span>
<img src="images/2-1.RMT.png" alt="Random matrix theory (RMT)-based approach" width="100%" height="80%"><p class="caption">
Figure 2.6: Random matrix theory (RMT)-based approach
</p>
</div>
<p>use <code><a href="https://rdrr.io/pkg/MetaNet/man/RMT_threshold.html">RMT_threshold()</a></code> , we can find the best r_threshold to make the network with smallest noise.</p>
<p>the bigger log_LE, less log_LW, less log_see, bigger p_ks_test indicate the better r_threshold for a meaningful network construction.You can change the threshold range to calculate more finely.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/MetaNet/man/RMT_threshold.html">RMT_threshold</a></span><span class="op">(</span><span class="va">corr</span>,min_threshold <span class="op">=</span> <span class="fl">0.5</span>,max_threshold <span class="op">=</span> <span class="fl">0.9</span>, step <span class="op">=</span> <span class="fl">0.02</span>,verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">-&gt;</span><span class="va">rmt_res</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rmt_res</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:3-RMT-res"></span>
<img src="images/2-2RMT.png" alt="RMT_threshold result from 0.5 to 0.9" width="100%"><p class="caption">
Figure 2.7: RMT_threshold result from 0.5 to 0.9
</p>
</div>
<p>You can set the <code>gif=T</code> in <code>RMT_threshold</code> and get a gif file to observe the distribution of eigenvalue spacing for different r-thresholds.</p>
<div class="figure">
<span style="display:block;" id="fig:3-RMT-res2"></span>
<img src="images/rmt_nnsd.gif" alt="the distribution of eigenvalue spacing from 0.5 to 0.9" width="100%"><p class="caption">
Figure 2.8: the distribution of eigenvalue spacing from 0.5 to 0.9
</p>
</div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction.html"><span class="header-section-number">1</span> Introduction</a></div>
<div class="next"><a href="manipulation.html"><span class="header-section-number">3</span> Manipulation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#construction"><span class="header-section-number">2</span> Construction</a></li>
<li><a class="nav-link" href="#normalization"><span class="header-section-number">2.1</span> Pre-processing</a></li>
<li>
<a class="nav-link" href="#pairwise-relationship"><span class="header-section-number">2.2</span> Pairwise relationship</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#correlation"><span class="header-section-number">2.2.1</span> Correlation</a></li>
<li><a class="nav-link" href="#distance"><span class="header-section-number">2.2.2</span> Distance</a></li>
<li><a class="nav-link" href="#sparcc"><span class="header-section-number">2.2.3</span> SparCC</a></li>
<li><a class="nav-link" href="#others"><span class="header-section-number">2.2.4</span> Others</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#build-network"><span class="header-section-number">2.3</span> Build network</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#normally-build"><span class="header-section-number">2.3.1</span> Normally build</a></li>
<li><a class="nav-link" href="#multi-tables"><span class="header-section-number">2.3.2</span> Multi-tables</a></li>
<li><a class="nav-link" href="#edgelist"><span class="header-section-number">2.3.3</span> Edgelist</a></li>
</ul>
</li>
<li><a class="nav-link" href="#rmt-optimize"><span class="header-section-number">2.4</span> RMT optimize</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/Asa12138/MetaNet_tutorial/blob/master/02-construction.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/Asa12138/MetaNet_tutorial/edit/master/02-construction.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>MetaNet Tutorial</strong>" was written by Peng Chen. It was last built on 2023-06-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
